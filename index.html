<!DOCTYPE html>
<html>
<head>
  <title>Barcodes</title>
</head>
<body>
  <h1>Barcodes</h1>
  <div id="barcodes"></div>
  <button onclick="window.print()">Print</button>

  <script src="https://cdn.jsdelivr.net/jsbarcode/3.11.5/JsBarcode.all.min.js" onload="fetchBarcodes()"></script>
  <script>
    async function fetchBarcodes() {
      const params = new URLSearchParams(window.location.search);
      const id = params.get("id");

      if (!id) {
        console.error("Missing ID in URL");
        return;
      }

      try {
        const response = await fetch(`/api/salesorder?id=${id}`);
        const items = await response.json();

        const container = document.getElementById("barcodes");

        items.forEach(item => {
          const div = document.createElement("div");
          div.style.marginBottom = "30px";

          const name = document.createElement("div");
          name.innerText = `${item.name} (${item.sku})`;

          const svg = document.createElementNS("http://www.w3.org/2000/svg", "svg");
          JsBarcode(svg, item.sku, { format: "CODE128", displayValue: true });

          div.appendChild(name);
          div.appendChild(svg);
          container.appendChild(div);
        });
      } catch (err) {
        console.error("Failed to load barcodes:", err);
      }
    }
  </script>
</body>
</html>

