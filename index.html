<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Barcodes</title>
  <script src="https://cdn.jsdelivr.net/jsbarcode/3.11.5/JsBarcode.all.min.js"></script>
</head>
<body>
  <h1>Barcodes</h1>
  <div id="barcodes">Loading barcodes...</div>
  <button onclick="window.print()">Print</button>

  <script>
    async function fetchBarcodes() {
      const params = new URLSearchParams(window.location.search);
      const id = params.get("id");
      const container = document.getElementById("barcodes");

      if (!id) {
        container.innerText = "Missing sales order ID in URL";
        return;
      }

      try {
        const response = await fetch(`/api/salesorder?id=${id}`);
        if (!response.ok) throw new Error("Failed to fetch barcodes");
        const items = await response.json();

        container.innerHTML = "";
        items.forEach(item => {
          const div = document.createElement("div");
          div.style.marginBottom = "30px";

          const name = document.createElement("div");
          name.innerText = `${item.name} (${item.sku})`;

          const svg = document.createElementNS("http://www.w3.org/2000/svg", "svg");
          JsBarcode(svg, item.sku, { format: "CODE128", displayValue: true });

          div.appendChild(name);
          div.appendChild(svg);
          container.appendChild(div);
        });
      } catch (err) {
        container.innerText = "Error loading barcodes: " + err.message;
        console.error(err);
      }
    }

    window.onload = fetchBarcodes;
  </script>
</body>
</html>
